FROM --platform=linux/386 alpine:latest

# 1. Enable Community & Testing Repositories
# 'hexedit' is in the 'testing' repo.
# 'cowsay' is in the 'community' repo.
RUN echo "http://dl-cdn.alpinelinux.org/alpine/edge/community" >> /etc/apk/repositories && \
    echo "http://dl-cdn.alpinelinux.org/alpine/edge/testing" >> /etc/apk/repositories && \
    apk update

# 2. Install All Packages
# 'shadow' is required to use 'useradd' and 'chpasswd'
# 'build-base' replaces 'gcc' + 'make'
RUN apk add --no-cache \
    bash \
    shadow \
    build-base \
    python3 \
    vim \
    unzip \
    ruby \
    nodejs \
    fakeroot \
    dbus \
    newt \
    hexedit \
    patch \
    file \
    luajit \
    lua5.4 \
    dialog \
    curl \
    less \
    netcat-openbsd \
    man-pages \
    mandoc \
    words \
    cowsay

# 3. User Setup
RUN useradd -m -s /bin/bash user && \
    echo "user:password" | chpasswd

# 4. Copy Assets
COPY --chown=user:user ./examples /home/user/examples
RUN chmod -R +x /home/user/examples/lua

# 5. Environment & Workdir
WORKDIR /home/user/
ENV HOME="/home/user" \
    TERM="xterm" \
    USER="user" \
    SHELL="/bin/bash" \
    EDITOR="vim" \
    LANG="en_US.UTF-8" \
    LC_ALL="C"

# 6. Root Password & CMD
RUN echo 'root:password' | chpasswd

CMD [ "/bin/bash" ]
